"use strict";var _interopRequireWildcard=require("@babel/runtime/helpers/interopRequireWildcard"),_interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:!0}),Object.defineProperty(exports,"SocketService",{enumerable:!0,get:function get(){return _SocketService["default"]}}),Object.defineProperty(exports,"Plugin",{enumerable:!0,get:function get(){return _Plugin["default"]}}),Object.defineProperty(exports,"Blockchains",{enumerable:!0,get:function get(){return _Blockchains.Blockchains}}),Object.defineProperty(exports,"Network",{enumerable:!0,get:function get(){return _Network["default"]}}),Object.defineProperty(exports,"WalletInterface",{enumerable:!0,get:function get(){return _WalletInterface["default"]}}),Object.defineProperty(exports,"WALLET_METHODS",{enumerable:!0,get:function get(){return _WalletInterface.WALLET_METHODS}}),exports.PluginTypes=exports["default"]=exports.EVENTS=void 0;var _regenerator=_interopRequireDefault(require("@babel/runtime/regenerator")),_asyncToGenerator2=_interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator")),_classCallCheck2=_interopRequireDefault(require("@babel/runtime/helpers/classCallCheck")),_createClass2=_interopRequireDefault(require("@babel/runtime/helpers/createClass")),_PluginRepository=_interopRequireDefault(require("./plugins/PluginRepository")),_SocketService=_interopRequireDefault(require("./services/SocketService")),_Plugin=_interopRequireDefault(require("./plugins/Plugin")),PluginTypes=_interopRequireWildcard(require("./plugins/PluginTypes"));exports.PluginTypes=PluginTypes;var origin,_Blockchains=require("./models/Blockchains"),_Network=_interopRequireDefault(require("./models/Network")),_WalletInterface=_interopRequireWildcard(require("./models/WalletInterface")),_LocalSocket=_interopRequireDefault(require("./wallets/LocalSocket")),_RelaySocket=_interopRequireDefault(require("./wallets/RelaySocket")),_Injection=_interopRequireDefault(require("./wallets/Injection")),_Token=_interopRequireDefault(require("./models/Token")),EVENTS={Disconnected:"dced",LoggedOut:"logout"};exports.EVENTS=EVENTS;var socketSetters=[],holderFns={},Index=/*#__PURE__*/function(){function a(){(0,_classCallCheck2["default"])(this,a),this.identity=null,this.network=null,_PluginRepository["default"].loadPlugin(new _RelaySocket["default"](this,holderFns)),_PluginRepository["default"].loadPlugin(new _LocalSocket["default"](this,holderFns)),_PluginRepository["default"].loadPlugin(new _Injection["default"](this,holderFns))}return(0,_createClass2["default"])(a,[{key:"loadPlugin",value:function loadPlugin(a){if(!a.isValid())throw new Error("".concat(a.name," doesn't seem to be a valid ScatterJS plugin."));_PluginRepository["default"].loadPlugin(a),a.type===PluginTypes.BLOCKCHAIN_SUPPORT&&(this[a.name]=a.signatureProvider(function noIdFunc(){if(!holderFns.get().identity)throw new Error("No Identity")},function(){return holderFns.get().identity}),this[a.name+"Hook"]=a.hookProvider,socketSetters.push(a.setSocketService)),a.type===PluginTypes.WALLET_SUPPORT&&a.init(this,holderFns,socketSetters)}},{key:"connect",value:function(){var a=(0,_asyncToGenerator2["default"])(/*#__PURE__*/_regenerator["default"].mark(function a(b,c){var d,e,f,g,h;return _regenerator["default"].wrap(function(a){for(;;)switch(a.prev=a.next){case 0:for(c||(c={}),this.network=c.hasOwnProperty("network")?c.network:null,d=_PluginRepository["default"].wallets(),e=!1,f=[],g=function(a){var g=d[a];f.push(Promise.race([g.connect(b,c).then(/*#__PURE__*/function(){var a=(0,_asyncToGenerator2["default"])(/*#__PURE__*/_regenerator["default"].mark(function a(b){return _regenerator["default"].wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(!b){a.next=12;break}if("injection"!==b&&socketSetters.map(function(a){return a(b)}),"function"!=typeof g.runBeforeInterfacing){a.next=5;break}return a.next=5,g.runBeforeInterfacing();case 5:if(new _WalletInterface["default"](g.name,g.methods(),holderFns.get()),"function"!=typeof g.runAfterInterfacing){a.next=9;break}return a.next=9,g.runAfterInterfacing();case 9:return _WalletInterface["default"].bindBasics(holderFns.get()),e=!0,a.abrupt("return",!0);case 12:case"end":return a.stop();}},a)}));return function(){return a.apply(this,arguments)}}()),new Promise(function(a){return setTimeout(function(){return a(!1)},c.initTimeout||3500)})]))},h=0;h<d.length;h++)g(h);return a.next=9,Promise.all(f);case 9:return a.abrupt("return",e);case 10:case"end":return a.stop();}},a,this)}));return function connect(){return a.apply(this,arguments)}}()}]),a}(),Holder=/*#__PURE__*/function(){function a(b){(0,_classCallCheck2["default"])(this,a),this.scatter=b}return(0,_createClass2["default"])(a,[{key:"plugins",value:function plugins(){var a=this;if(!this.scatter.isExtension){for(var b=arguments.length,c=Array(b),d=0;d<b;d++)c[d]=arguments[d];c.map(function(b){return a.scatter.loadPlugin(b)})}}},{key:"connect",value:function connect(){var a;return(a=this.scatter).connect.apply(a,arguments)}},{key:"catchAll",value:function catchAll(){}}]),a}(),holder=new Proxy(new Holder(new Index()),{get:function get(a,b){return"undefined"==typeof a[b]?a.scatter[b]:a[b]}});holderFns.set=function(a){return holder.scatter=a},holderFns.get=function(){return holder.scatter},"undefined"!=typeof window&&(window.ScatterJS=holder),holder.Plugin=_Plugin["default"],holder.PluginTypes=PluginTypes,holder.Blockchains=_Blockchains.Blockchains,holder.Network=_Network["default"],holder.Token=_Token["default"],holder.SocketService=_SocketService["default"],holder.EVENTS=EVENTS,holder.WalletInterface=_WalletInterface["default"],holder.WALLET_METHODS=_WalletInterface.WALLET_METHODS;var _default=holder;exports["default"]=_default;